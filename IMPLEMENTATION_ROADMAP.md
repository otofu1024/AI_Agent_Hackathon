# TRPGシナリオ作成支援ツール - 実装ロードマップ

## 📋 プロジェクト概要
- **プロジェクト名**: Scenario Architect with Gemini
- **目的**: AIを活用したTRPGシナリオ作成支援ツール
- **技術スタック**: Python, FastAPI, Google Cloud Vertex AI (Gemini)

---

## 🎯 実装フェーズ

### **Phase 1: 基盤構築 ✅ 完了**
- [x] プロジェクト構造の作成
- [x] 環境設定（.env, requirements.txt）
- [x] 基本的なGemini API連携
- [x] FastAPIアプリケーションの基本構造
- [x] 基本的なテストファイル

### **Phase 2: AI連携機能の完成 🔄 進行中**
- [x] Gemini API統合
- [x] Google Cloud Vertex AIとの連携
- [ ] APIキー管理・認証の実装
- [ ] リクエスト制限・レート制限の実装
- [ ] エラーハンドリング・フォールバック処理の強化

### **Phase 3: データベース連携**
- [ ] データベース設計（PostgreSQL）
- [ ] SQLAlchemy ORMの設定
- [ ] シナリオ保存・取得機能
- [ ] ユーザー管理機能
- [ ] データベースマイグレーション

### **Phase 4: 認証・セキュリティ**
- [ ] JWT認証システム
- [ ] ユーザー登録・ログイン機能
- [ ] パスワードハッシュ化
- [ ] セッション管理
- [ ] CSRF対策

### **Phase 5: コア機能の実装**
- [ ] シナリオCRUD操作
- [ ] シナリオ検索・フィルタリング
- [ ] シナリオエクスポート機能（PDF, テキスト）
- [ ] シナリオ共有機能
- [ ] バージョン管理機能

### **Phase 6: 高度なAI機能**
- [ ] コンテキストに応じたアイデア提案
- [ ] 情景・NPC描写の強化機能
- [ ] シナリオ品質チェック機能
- [ ] 伏線管理チェッカー
- [ ] キャラクター一貫性チェック

### **Phase 7: フロントエンド開発**
- [ ] Next.js プロジェクトのセットアップ
- [ ] 基本的なUIコンポーネント
- [ ] シナリオ作成画面
- [ ] シナリオ一覧画面
- [ ] ユーザー設定画面

### **Phase 8: 統合・テスト**
- [ ] フロントエンドとバックエンドの統合
- [ ] API統合テスト
- [ ] ユーザー受け入れテスト
- [ ] パフォーマンステスト
- [ ] セキュリティテスト

### **Phase 9: デプロイ・運用**
- [ ] Google Cloud Run へのデプロイ
- [ ] ドメイン設定
- [ ] SSL証明書の設定
- [ ] 監視・ログ設定
- [ ] バックアップ設定

---

## 🚀 次の実装ステップ（優先順位順）

### **1. 即座に実装すべき項目**
1. **APIキー管理・認証の実装**
   - 環境変数での安全な管理
   - サービスアカウント認証
   - 認証エラーハンドリング

2. **レート制限の実装**
   - ユーザーごとのリクエスト制限
   - 時間枠別制限（1分、1時間）
   - 制限超過時の適切なエラーレスポンス

3. **エラーハンドリングの強化**
   - Gemini API エラーの適切な処理
   - リトライ機能の実装
   - ログ記録の強化

### **2. 短期間で実装すべき項目**
1. **データベース設計・実装**
   - シナリオテーブルの設計
   - ユーザーテーブルの設計
   - SQLAlchemy モデルの実装

2. **基本的なCRUD操作**
   - シナリオの保存・取得
   - シナリオの更新・削除
   - シナリオ一覧の取得

### **3. 中期で実装すべき項目**
1. **認証システム**
   - JWT トークン認証
   - ユーザー登録・ログイン
   - パスワード管理

2. **高度なAI機能**
   - コンテキストに応じた提案
   - 描写強化機能
   - 品質チェック機能

---

## 📝 実装のベストプラクティス

### **1. 段階的開発**
- 小さな機能から始めて、徐々に複雑にする
- 各段階でテストを実行
- 動作確認してから次の段階に進む

### **2. エラーハンドリング**
- すべてのAPI呼び出しでエラーハンドリング
- 適切なログ記録
- ユーザーフレンドリーなエラーメッセージ

### **3. セキュリティ**
- 機密情報は環境変数で管理
- 入力値の検証
- SQLインジェクション対策

### **4. テスト**
- 各機能のユニットテスト
- API統合テスト
- エラーケースのテスト

---

## 🛠️ 開発環境の準備

### **必要なツール**
- Python 3.8以上
- Google Cloud SDK
- PostgreSQL（データベース用）
- Git（バージョン管理）

### **推奨エディタ**
- VS Code（Python拡張機能付き）
- PyCharm（Professional版）

---

## 📚 参考資料

### **公式ドキュメント**
- [FastAPI公式ドキュメント](https://fastapi.tiangolo.com/)
- [Google Cloud Vertex AI](https://cloud.google.com/vertex-ai)
- [SQLAlchemy公式ドキュメント](https://docs.sqlalchemy.org/)

### **学習リソース**
- Python 型ヒントの使い方
- FastAPI のベストプラクティス
- Google Cloud の認証方法

---

## 🎯 成功指標

### **Phase 2完了時**
- [ ] Gemini API が安定して動作
- [ ] レート制限が適切に機能
- [ ] エラーハンドリングが完備

### **Phase 5完了時**
- [ ] 基本的なシナリオ作成・保存が可能
- [ ] ユーザー認証が機能
- [ ] データベース連携が完了

### **Phase 8完了時**
- [ ] フロントエンドとバックエンドが統合
- [ ] 全機能がテスト済み
- [ ] 本番環境での動作確認完了

---

## 📞 サポート

実装中に問題が発生した場合：
1. エラーメッセージを確認
2. ログファイルをチェック
3. 段階的にデバッグ
4. 必要に応じてサポートを依頼

---

**最終更新日**: 2025年1月27日
**バージョン**: 1.0.0
